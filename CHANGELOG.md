# 更新日志

本文档记录了BadgePatternTool项目的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.2.0] - 2025-06-18

### 新增
- **🔄 同一图片多次导入**: 支持同一张图片的多次导入，每个实例都有独立的编辑参数
- **🖱️ 拖拽导入功能**: 支持从文件管理器直接拖拽图片到程序中，支持批量拖拽导入
- **📋 图片复制功能**: 新增复制按钮，可以复制已导入的图片并独立编辑裁切参数

### 改进
- **🏷️ 智能实例标识**: 同一文件的多个实例自动显示序号标识(如: photo#1.jpg, photo#2.jpg)
- **🆔 唯一标识系统**: 每个图片实例都有唯一的UUID标识符，确保独立性
- **🎯 用户体验优化**: 复制的图片会插入到选中项下方，便于管理和编辑

### 技术改进
- 重构ImageItem类，添加unique_id和instance_number属性
- 实现完整的拖拽事件处理机制(dragEnterEvent, dragMoveEvent, dropEvent)
- 优化图片列表显示逻辑，支持多实例区分
- 移除重复文件检查限制，允许灵活的图片管理

### 验证
- ✅ 所有新功能单元测试通过
- ✅ 重复导入功能正常工作
- ✅ 拖拽导入支持多种图片格式
- ✅ 复制功能保持参数独立性
- ✅ A4预览和导出功能兼容新特性

## [1.1.0] - 2025-06-17

### 新增
- **🔧 全面代码重构**: 完成项目代码质量优化和结构重构
- **🛠️ 开发工具链**: 新增代码质量检查工具和统一开发脚本
- **📦 程序打包**: 成功打包为Windows可执行文件(53.8MB)
- **🧪 测试框架**: 完善的单元测试和集成测试体系

### 改进
- **🧹 项目清理**: 删除30+个冗余文件，精简项目结构
- **📚 文档整理**: 重新组织文档体系，保留核心文档
- **⚡ 导入优化**: 修复所有重复导入，优化模块结构
- **🎯 质量提升**: 修复代码质量问题，提升可维护性

### 技术改进
- 建立标准化的开发工具链
- 完善错误处理和异常捕获
- 优化代码规范和结构
- 提升项目专业性和可扩展性

### 验证
- ✅ 16个测试全部通过
- ✅ 程序功能完整可用
- ✅ 打包程序正常运行
- ✅ 代码质量显著提升

## [1.0.1] - 2025-06-17

### 新增
- **🎯 灰色圆形预览**: 在没有导入图片时显示灰色圆形占位符，直观展示排版布局
- **⚙️ 优化默认设置**: 默认使用紧密排列、5mm间距/边距、PNG输出格式

### 视觉改进
- **🔘 实心圆形占位符**: 占位圆形改为实心填充，更加醒目直观
- **🎨 深灰色背景**: A4画布外背景改为深灰色(#505050)，增强视觉对比度

### 修复
- **🖨️ 打印功能重大修复**: 采用Qt标准槽函数实现，修复打印过程中的错误
- **🔧 信号连接优化**: 替换lambda连接为标准信号槽机制，提升稳定性
- **⚡ QPainter初始化改进**: 按照Qt文档标准方式初始化，避免时机问题
- **🛡️ 错误处理增强**: 完善异常捕获和调试信息，便于问题诊断

### 技术改进
- 统一打印预览和直接打印的实现逻辑
- 增加详细的打印功能修复说明文档
- 参考Qt官方文档的最佳实践

## [1.0.0] - 2025-06-17

### 新增
- 初始化项目结构和Git版本管理
- 集成PySide6现代化GUI框架
- **完整的图片导入功能**: 支持多种格式，文件验证，批量导入
- **图片列表管理**: 添加、删除、清空、选择状态跟踪
- **圆形图片编辑器**: 实时预览，缩放调整，位置偏移控制
- **自动排版功能**: 智能计算最佳参数，批量处理图片
- **多格式导出**: 支持PDF/PNG/JPG高质量导出
- **A4排版布局**: 网格和紧密排列模式
- 完整的用户界面：菜单栏、工具栏、状态栏
- 错误处理和用户反馈机制
- 跨平台文件夹打开功能

### UI/UX 重大改进 (2025-06-17)
- **🎯 数量设置功能优化**: 将数量控制从图片列表移至单图编辑区域，提供更直观的编辑体验
- **🔷 六边形蜂巢布局**: 重构紧密排列算法，实现真正的六边形密排，确保相邻图片距离完全相等
- **🖼️ 图片列表缩略图**: 添加48x48像素缩略图显示，快速识别图片内容，提升用户体验
- **⚡ 滑条操作性能优化**: 实现150ms防抖机制，消除缩放、位置调整等操作的卡顿问题
- **🖱️ A4预览交互增强**: 支持鼠标滚轮缩放(0.1x-3.0x)和拖动平移，提供专业级预览体验

### 核心功能增强 (2025-06-17)
- **🔧 动态圆形尺寸配置**: 添加全局圆形直径设置(10-100mm)，支持实时调整和预设尺寸
- **🚀 性能优化**: 分层防抖机制，数量变化卡顿问题完全解决
- **🔍 布局算法修复**: 修正紧凑布局重叠问题，确保5mm间距下圆形不重叠
- **📊 容量分析**: 提供不同尺寸下的布局容量对照表，优化排版效果
- **🖨️ 打印引擎重构**: 采用预渲染技术，性能提升70%，内存占用减少50%，消除打印时的调试输出干扰

### 代码质量提升 (2025-06-17)
- **🧹 项目结构重构**: 清理30+个冗余文件，建立标准化项目结构
- **🧪 测试框架完善**: 新增完整的单元测试、集成测试和测试运行器
- **🛠️ 开发工具链**: 新增代码质量检查、构建脚本、开发工具等
- **📚 文档整理**: 重新组织文档结构，更新技术信息，完善使用指南
- **⚡ 导入优化**: 规范化所有模块的导入语句，提升代码质量

### 变更
- **重大变更**: GUI框架从tkinter完全迁移到PySide6
- 更新所有图片处理模块支持QPixmap
- 重构文件处理器使用PySide6文件对话框
- 采用现代化Qt界面布局和组件
- 改进用户体验和界面响应性

### 修复
- 修复PySide6弃用警告问题
- 优化高DPI显示兼容性
- 完善错误处理和异常捕获

### 移除
- 移除tkinter和ImageTk依赖
- 清理未使用的导入和代码

---

## 版本说明

### 版本号格式
- 主版本号：不兼容的API修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

### 变更类型
- **新增** - 新功能
- **变更** - 对现有功能的变更
- **弃用** - 即将移除的功能
- **移除** - 已移除的功能
- **修复** - 问题修复
- **安全** - 安全相关修复
