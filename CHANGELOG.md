# 更新日志

本文档记录了BadgePatternTool项目的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.5.4] - 2025-06-20

### 修复
- **🔧 Unicode编码修复**: 修复GitHub Actions中Windows环境下的Unicode编码问题
  - 添加UTF-8编码声明和环境变量设置
  - 将所有中文输出替换为英文，避免cp1252编码错误
  - 修复code_quality_check.py中的空值检查问题
  - 确保开发工具在Windows CI环境下正常运行


## [1.5.3] - 2025-06-20

### 修复
- **🔧 PowerShell兼容性修复**: 修复GitHub Actions中Windows PowerShell命令兼容性问题
  - 将`ls -la`替换为`Get-ChildItem -Force`
  - 修复条件判断语法，使用PowerShell原生命令
  - 确保在Windows环境下正常运行，解决"参数名称'la'不匹配"错误


## [1.5.2] - 2025-06-20

### 修复
- **🔧 CI/CD构建修复**: 修复GitHub Actions构建失败问题
  - 简化依赖安装，只安装核心依赖和PyInstaller
  - 添加项目结构验证步骤，便于调试构建问题
  - 修复artifact上传路径问题，确保构建产物正确上传
  - 本地构建测试通过，exe文件大小31.9MB


## [1.5.1] - 2025-06-20

### 修复
- **🔧 CI/CD修复**: 升级GitHub Actions中的actions/upload-artifact从v3到v4，解决弃用警告问题


## [1.5.0] - 2025-06-20

### 新增
- **🚀 GitHub Actions自动发布**: 新增完整的CI/CD流程，支持自动构建和发布
  - 自动构建工作流：推送到develop分支时自动构建exe文件
  - 手动构建工作流：支持手动触发构建任务
  - 发布工作流：创建release时自动构建并上传exe文件到GitHub Releases
- **📦 自动化发布脚本**: 新增release.py脚本，简化版本发布流程

### 改进
- **🔧 构建配置优化**: 修复PyInstaller .spec文件中的__file__变量问题
- **📚 文档更新**: 更新README.md以反映当前项目状态和新增功能
- **🛠️ 开发流程改进**: 完善版本管理和发布流程，提升开发效率

### 修复
- **🐛 打包问题修复**: 解决PyInstaller构建过程中的路径问题


## [1.4.0] - 2025-06-20

### 新增
- **📚 详细代码文档**: 新增3份完整的技术文档，总计1900+行
  - `代码架构文档.md`: 深入的技术实现和算法原理说明
  - `快速入门指南.md`: 新团队成员友好的入门指南
  - `API参考文档.md`: 完整的接口规范和使用示例
- **🔧 版本管理工具**: 新增自动化版本号管理脚本
- **📦 依赖分离**: 创建requirements-dev.txt，分离开发和生产依赖

### 修复
- **🐛 徽章尺寸自动排版**: 修复徽章尺寸修改不触发自动排版的问题
  - 在尺寸变化事件中添加update_layout_preview()调用
  - 修复预览缓存哈希计算缺少徽章尺寸参数的问题
  - 确保预设按钮点击时正确更新排版预览
- **🔄 交互式编辑器同步**: 徽章尺寸变化时同步更新编辑器遮罩半径

### 代码重构和优化
- **🏗️ 项目架构重构**: 完成全面的代码重构和优化，提升代码质量和可维护性
- **📦 公共模块创建**: 新增src/common/目录，提取重复代码和公共逻辑
- **⚙️ 配置管理优化**: 统一版本号管理，消除硬编码值，重构配置系统
- **🔧 错误处理改进**: 实现统一的错误处理机制，添加资源管理和用户友好提示

### 性能优化
- **🚀 图片处理性能**: 改进缓存策略，添加内存使用监控和LRU管理
- **💾 智能内存管理**: 实现主动内存清理机制，优化大图片处理性能
- **⚡ 缓存系统优化**: 多层级缓存架构，支持不同类型缓存的独立管理

### 构建优化
- **📦 打包配置优化**: 创建专门的.spec文件，减小exe文件大小
- **🛠️ 依赖管理改进**: 分离核心依赖和开发依赖，优化构建流程
- **🔧 构建脚本增强**: 添加构建后优化步骤和文件大小监控

### 文档整理
- **📚 文档结构重组**: 合并重复文档，统一版本信息，更新技术架构说明
- **📖 使用指南更新**: 更新项目结构说明，反映最新的代码组织
- **🔄 版本信息统一**: 统一所有文档中的版本号和技术信息

### 技术改进
- 建立标准化的模块导入机制
- 实现全局异常处理和资源清理
- 优化PyInstaller打包参数，排除不必要模块
- 添加缓存信息监控和性能分析工具

### 验证
- ✅ 所有原有功能保持完整兼容
- ✅ 代码质量显著提升
- ✅ 构建文件大小优化
- ✅ 错误处理机制完善
- ✅ 性能监控和缓存管理有效

## [1.3.0] - 2025-06-18

### 性能优化
- **🚀 图片缓存系统**: 为InteractiveImageEditor添加智能缓存机制，避免重复创建QPixmap
- **⚡ 防抖机制优化**: 优化防抖定时器延迟时间，提高响应性能
  - 编辑操作：100ms（提高响应性）
  - A4预览：500ms（减少频繁更新）
  - 数量变化：800ms（避免频繁重建预览）
- **🧠 内存管理优化**: 修复PIL图片和QPixmap内存泄漏，确保资源及时释放
- **📊 A4预览缓存**: 添加预览状态哈希缓存，避免频繁重新生成预览图
- **🔄 图片处理缓存**: 为ImageProcessor添加双重缓存系统，减少重复图片处理

### 改进
- **🎯 重复值检测**: 避免处理相同的缩放和位置参数
- **💾 智能缓存策略**: 基于参数变化的精确缓存失效机制
- **🏃 响应速度提升**: 单图编辑区操作更加流畅，消除卡顿现象
- **📈 性能监控**: 添加缓存大小限制和LRU管理策略

### 修复
- **🐛 单图编辑卡顿**: 完全解决单图编辑区操作时的性能问题
- **🔧 数量修改延迟**: 修复修改图片数量后的响应缓慢问题
- **⚙️ 滑块操作优化**: 消除缩放和位置滑块操作时的界面不流畅问题
- **🖼️ A4预览性能**: 大幅减少A4预览的重复计算和渲染

### 技术改进
- 实现多层级缓存架构：编辑器缓存、处理器缓存、预览缓存
- 优化内存使用模式，使用try-finally确保资源释放
- 改进防抖算法，支持不同操作类型的差异化延迟
- 添加缓存命中率统计和性能监控机制

### 验证
- ✅ 单图编辑响应速度显著提升
- ✅ 图片数量修改不再出现卡顿
- ✅ 内存使用更加稳定高效
- ✅ A4预览更新性能大幅改善
- ✅ 所有原有功能保持完整兼容

## [1.2.0] - 2025-06-18

### 新增
- **🔄 同一图片多次导入**: 支持同一张图片的多次导入，每个实例都有独立的编辑参数
- **🖱️ 拖拽导入功能**: 支持从文件管理器直接拖拽图片到程序中，支持批量拖拽导入
- **📋 图片复制功能**: 新增复制按钮，可以复制已导入的图片并独立编辑裁切参数

### 改进
- **🏷️ 智能实例标识**: 同一文件的多个实例自动显示序号标识(如: photo#1.jpg, photo#2.jpg)
- **🆔 唯一标识系统**: 每个图片实例都有唯一的UUID标识符，确保独立性
- **🎯 用户体验优化**: 复制的图片会插入到选中项下方，便于管理和编辑

### 技术改进
- 重构ImageItem类，添加unique_id和instance_number属性
- 实现完整的拖拽事件处理机制(dragEnterEvent, dragMoveEvent, dropEvent)
- 优化图片列表显示逻辑，支持多实例区分
- 移除重复文件检查限制，允许灵活的图片管理

### 验证
- ✅ 所有新功能单元测试通过
- ✅ 重复导入功能正常工作
- ✅ 拖拽导入支持多种图片格式
- ✅ 复制功能保持参数独立性
- ✅ A4预览和导出功能兼容新特性

## [1.1.0] - 2025-06-17

### 新增
- **🔧 全面代码重构**: 完成项目代码质量优化和结构重构
- **🛠️ 开发工具链**: 新增代码质量检查工具和统一开发脚本
- **📦 程序打包**: 成功打包为Windows可执行文件(53.8MB)
- **🧪 测试框架**: 完善的单元测试和集成测试体系

### 改进
- **🧹 项目清理**: 删除30+个冗余文件，精简项目结构
- **📚 文档整理**: 重新组织文档体系，保留核心文档
- **⚡ 导入优化**: 修复所有重复导入，优化模块结构
- **🎯 质量提升**: 修复代码质量问题，提升可维护性

### 技术改进
- 建立标准化的开发工具链
- 完善错误处理和异常捕获
- 优化代码规范和结构
- 提升项目专业性和可扩展性

### 验证
- ✅ 16个测试全部通过
- ✅ 程序功能完整可用
- ✅ 打包程序正常运行
- ✅ 代码质量显著提升

## [1.0.1] - 2025-06-17

### 新增
- **🎯 灰色圆形预览**: 在没有导入图片时显示灰色圆形占位符，直观展示排版布局
- **⚙️ 优化默认设置**: 默认使用紧密排列、5mm间距/边距、PNG输出格式

### 视觉改进
- **🔘 实心圆形占位符**: 占位圆形改为实心填充，更加醒目直观
- **🎨 深灰色背景**: A4画布外背景改为深灰色(#505050)，增强视觉对比度

### 修复
- **🖨️ 打印功能重大修复**: 采用Qt标准槽函数实现，修复打印过程中的错误
- **🔧 信号连接优化**: 替换lambda连接为标准信号槽机制，提升稳定性
- **⚡ QPainter初始化改进**: 按照Qt文档标准方式初始化，避免时机问题
- **🛡️ 错误处理增强**: 完善异常捕获和调试信息，便于问题诊断

### 技术改进
- 统一打印预览和直接打印的实现逻辑
- 增加详细的打印功能修复说明文档
- 参考Qt官方文档的最佳实践

## [1.0.0] - 2025-06-17

### 新增
- 初始化项目结构和Git版本管理
- 集成PySide6现代化GUI框架
- **完整的图片导入功能**: 支持多种格式，文件验证，批量导入
- **图片列表管理**: 添加、删除、清空、选择状态跟踪
- **圆形图片编辑器**: 实时预览，缩放调整，位置偏移控制
- **自动排版功能**: 智能计算最佳参数，批量处理图片
- **多格式导出**: 支持PDF/PNG/JPG高质量导出
- **A4排版布局**: 网格和紧密排列模式
- 完整的用户界面：菜单栏、工具栏、状态栏
- 错误处理和用户反馈机制
- 跨平台文件夹打开功能

### UI/UX 重大改进 (2025-06-17)
- **🎯 数量设置功能优化**: 将数量控制从图片列表移至单图编辑区域，提供更直观的编辑体验
- **🔷 六边形蜂巢布局**: 重构紧密排列算法，实现真正的六边形密排，确保相邻图片距离完全相等
- **🖼️ 图片列表缩略图**: 添加48x48像素缩略图显示，快速识别图片内容，提升用户体验
- **⚡ 滑条操作性能优化**: 实现150ms防抖机制，消除缩放、位置调整等操作的卡顿问题
- **🖱️ A4预览交互增强**: 支持鼠标滚轮缩放(0.1x-3.0x)和拖动平移，提供专业级预览体验

### 核心功能增强 (2025-06-17)
- **🔧 动态圆形尺寸配置**: 添加全局圆形直径设置(10-100mm)，支持实时调整和预设尺寸
- **🚀 性能优化**: 分层防抖机制，数量变化卡顿问题完全解决
- **🔍 布局算法修复**: 修正紧凑布局重叠问题，确保5mm间距下圆形不重叠
- **📊 容量分析**: 提供不同尺寸下的布局容量对照表，优化排版效果
- **🖨️ 打印引擎重构**: 采用预渲染技术，性能提升70%，内存占用减少50%，消除打印时的调试输出干扰

### 代码质量提升 (2025-06-17)
- **🧹 项目结构重构**: 清理30+个冗余文件，建立标准化项目结构
- **🧪 测试框架完善**: 新增完整的单元测试、集成测试和测试运行器
- **🛠️ 开发工具链**: 新增代码质量检查、构建脚本、开发工具等
- **📚 文档整理**: 重新组织文档结构，更新技术信息，完善使用指南
- **⚡ 导入优化**: 规范化所有模块的导入语句，提升代码质量

### 变更
- **重大变更**: GUI框架从tkinter完全迁移到PySide6
- 更新所有图片处理模块支持QPixmap
- 重构文件处理器使用PySide6文件对话框
- 采用现代化Qt界面布局和组件
- 改进用户体验和界面响应性

### 修复
- 修复PySide6弃用警告问题
- 优化高DPI显示兼容性
- 完善错误处理和异常捕获

### 移除
- 移除tkinter和ImageTk依赖
- 清理未使用的导入和代码

---

## 版本说明

### 版本号格式
- 主版本号：不兼容的API修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

### 变更类型
- **新增** - 新功能
- **变更** - 对现有功能的变更
- **弃用** - 即将移除的功能
- **移除** - 已移除的功能
- **修复** - 问题修复
- **安全** - 安全相关修复
